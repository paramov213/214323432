<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Colony OS: Persistent Edition</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root { --bg: #05070a; --card: #111418; --accent: #00d2ff; --money: #2ecc71; --text: #e0e0e0; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; display: flex; margin: 0; height: 100vh; overflow: hidden; }
        .sidebar { width: 320px; background: var(--card); padding: 20px; border-right: 1px solid #222; display: flex; flex-direction: column; }
        .main { flex: 1; padding: 25px; overflow-y: auto; background: radial-gradient(circle at top right, #0a1520, #05070a); }
        .card { background: #1a1e23; padding: 15px; border-radius: 12px; border: 1px solid #333; margin-bottom: 15px; }
        .chat-box { flex: 1; background: #000; border: 1px solid #222; margin-top: 15px; padding: 10px; overflow-y: auto; font-family: monospace; font-size: 13px; color: #0f0; }
        input { background: #000; border: 1px solid #333; color: #fff; padding: 10px; width: 100%; box-sizing: border-box; }
        .btn { cursor: pointer; border: none; padding: 12px; border-radius: 6px; font-weight: bold; background: var(--accent); color: #000; margin-top: 5px; }
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="card" style="width: 300px; text-align: center;">
        <h2 style="color:var(--accent)">COLONY OS</h2>
        <input type="text" id="log" placeholder="Логин" style="margin-bottom:10px;">
        <input type="password" id="pas" placeholder="Пароль" style="margin-bottom:20px;">
        <button class="btn" onclick="auth()" style="width:100%">ВОЙТИ / РЕГИСТРАЦИЯ</button>
    </div>
</div>

<div class="sidebar">
    <h2 id="display-name" style="color:var(--accent); margin:0;">Пользователь</h2>
    <div class="card" style="margin-top:20px; border-left: 4px solid var(--money);">
        <small>БАЛАНС</small>
        <h2 id="cash-val" style="color:var(--money); margin:5px 0;">$0</h2>
    </div>
    
    <div class="chat-box" id="chat"></div>
    <input type="text" id="chat-msg" placeholder="Сообщение..." onkeypress="if(event.key==='Enter') sendChat()" style="margin-top:10px;">
    
    <button class="btn" style="background:#e74c3c; color:#fff; margin-top:20px;" onclick="adminPanel()">ADMIN PANEL</button>
</div>

<div class="main">
    <h3 style="opacity:0.7;">МАГАЗИН ФРАНШИЗ</h3>
    <div id="market-list" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap:15px;"></div>
    
    <h3 style="margin-top:40px; opacity:0.7;">МОИ ОБЪЕКТЫ</h3>
    <div id="my-assets" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap:15px;"></div>
</div>

<script>
    const socket = io();

    function auth() {
        const username = document.getElementById('log').value;
        const password = document.getElementById('pas').value;
        if(username && password) socket.emit('auth', { username, password });
    }

    socket.on('init', data => {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('display-name').innerText = data.player.username;
        const mList = document.getElementById('market-list');
        mList.innerHTML = data.market.map(item => `
            <div class="card">
                <b>${item.name}</b><br>
                <span style="color:var(--money)">$${item.price}</span><br>
                <small>Доход: $${item.profit}/с</small><br>
                <button class="btn" style="font-size:10px; padding:5px; width:100%;" onclick="socket.emit('buy_request', ${item.id})">КУПИТЬ</button>
            </div>
        `).join('');
    });

    socket.on('update_data', p => {
        document.getElementById('cash-val').innerText = '$' + Math.floor(p.cash).toLocaleString();
        document.getElementById('my-assets').innerHTML = p.owned.map(i => `
            <div class="card" style="border-left: 2px solid var(--money); padding: 10px;">
                <b>${i.name}</b><br><small>+$${i.profit}/с</small>
            </div>
        `).join('');
    });

    socket.on('chat_msg', d => {
        const c = document.getElementById('chat');
        c.innerHTML += `<div><b>${d.user}:</b> ${d.text}</div>`;
        c.scrollTop = c.scrollHeight;
    });

    function sendChat() {
        const inp = document.getElementById('chat-msg');
        if(inp.value) { socket.emit('send_chat', inp.value); inp.value = ''; }
    }

    function adminPanel() {
        const login = prompt("Логин:");
        const pass = prompt("Пароль:");
        socket.emit('admin_login', { login, pass });
    }

    socket.on('admin_auth_success', () => {
        const target = prompt("Ник игрока:");
        const action = prompt("Действие: cash / ban");
        socket.emit('admin_cmd', { type: action === 'cash' ? 'add_cash' : 'ban', target });
    });

    socket.on('event', d => alert(d.msg));
</script>
</body>
</html>